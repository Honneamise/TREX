/* HEADERS */
#include <dos.h>
#include <math.h>
#include <mem.h>
#include <stdlib.h>
#include <stdio.h>

#include "DIXIE/BASE.H"
#include "DIXIE/CORE.H"
#include "DIXIE/EXT.H"

/* DEFINES */
#define CGA_0 0xB8000000L
#define CGA_1 0xB8002000L

#define MASK_0 0xC0 /* 11 00 00 00 */
#define MASK_1 0x30 /* 00 11 00 00 */
#define MASK_2 0x0C /* 00 00 11 00 */
#define MASK_3 0x03 /* 00 00 00 11 */

#define FONT_W 0x08
#define FONT_H 0x08

#define CHARSET_SIZE         0x0100
#define CHARSET_UNKNOW       0x3F

#define CHARSET_SP           0x20
#define CHARSET_TAB          0x09
#define CHARSET_CR           0x0D
#define CHARSET_LF           0x0A
#define CHARSET_HASH         0x23

/* TYPEDEFS */
typedef struct Core
{
    byte restore_mode;
    byte *buffer_0;
    byte *buffer_1;
	byte color;

    Timer sound_timer;
    float sound_len;

} Core;

/* VARIABLES */
static Core CORE = {0};

static byte PIXEL_MASK[4] = { MASK_0, MASK_1, MASK_2, MASK_3 };

/* original font */
/*static byte FONT[2048] = 
{
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x81, 0xA5, 0x81, 0xBD, 0x99, 0x81, 0x7E, 
0x7E, 0xFF, 0xDB, 0xFF, 0xC3, 0xE7, 0xFF, 0x7E, 0x6C, 0xFE, 0xFE, 0xFE, 0x7C, 0x38, 0x10, 0x00, 
0x10, 0x38, 0x7C, 0xFE, 0x7C, 0x38, 0x10, 0x00, 0x38, 0x7C, 0x38, 0xFE, 0xFE, 0xD6, 0x10, 0x38,
0x10, 0x10, 0x38, 0x7C, 0xFE, 0x7C, 0x10, 0x38, 0x00, 0x00, 0x18, 0x3C, 0x3C, 0x18, 0x00, 0x00, 
0xFF, 0xFF, 0xE7, 0xC3, 0xC3, 0xE7, 0xFF, 0xFF, 0x00, 0x3C, 0x66, 0x42, 0x42, 0x66, 0x3C, 0x00, 
0xFF, 0xC3, 0x99, 0xBD, 0xBD, 0x99, 0xC3, 0xFF, 0x0F, 0x07, 0x0F, 0x7D, 0xCC, 0xCC, 0xCC, 0x78,
0x3C, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x7E, 0x18, 0x3F, 0x33, 0x3F, 0x30, 0x30, 0x70, 0xF0, 0xE0, 
0x7F, 0x63, 0x7F, 0x63, 0x63, 0x67, 0xE6, 0xC0, 0x18, 0xDB, 0x3C, 0xE7, 0xE7, 0x3C, 0xDB, 0x18, 
0x80, 0xE0, 0xF8, 0xFE, 0xF8, 0xE0, 0x80, 0x00, 0x02, 0x0E, 0x3E, 0xFE, 0x3E, 0x0E, 0x02, 0x00,
0x18, 0x3C, 0x7E, 0x18, 0x18, 0x7E, 0x3C, 0x18, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x66, 0x00,
0x7F, 0xDB, 0xDB, 0x7B, 0x1B, 0x1B, 0x1B, 0x00, 0x3E, 0x63, 0x38, 0x6C, 0x6C, 0x38, 0xCC, 0x78, 
0x00, 0x00, 0x00, 0x00, 0x7E, 0x7E, 0x7E, 0x00, 0x18, 0x3C, 0x7E, 0x18, 0x7E, 0x3C, 0x18, 0xFF,
0x18, 0x3C, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x3C, 0x18, 0x00, 
0x00, 0x18, 0x0C, 0xFE, 0x0C, 0x18, 0x00, 0x00, 0x00, 0x30, 0x60, 0xFE, 0x60, 0x30, 0x00, 0x00, 
0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xFE, 0x00, 0x00, 0x00, 0x24, 0x66, 0xFF, 0x66, 0x24, 0x00, 0x00,
0x00, 0x18, 0x3C, 0x7E, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x7E, 0x3C, 0x18, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x78, 0x78, 0x30, 0x30, 0x00, 0x30, 0x00, 
0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6C, 0x6C, 0xFE, 0x6C, 0xFE, 0x6C, 0x6C, 0x00,
0x30, 0x7C, 0xC0, 0x78, 0x0C, 0xF8, 0x30, 0x00, 0x00, 0xC6, 0xCC, 0x18, 0x30, 0x66, 0xC6, 0x00, 
0x38, 0x6C, 0x38, 0x76, 0xDC, 0xCC, 0x76, 0x00, 0x60, 0x60, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x18, 0x30, 0x60, 0x60, 0x60, 0x30, 0x18, 0x00, 0x60, 0x30, 0x18, 0x18, 0x18, 0x30, 0x60, 0x00,
0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00, 0x00, 0x30, 0x30, 0xFC, 0x30, 0x30, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x60, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00, 0x06, 0x0C, 0x18, 0x30, 0x60, 0xC0, 0x80, 0x00,
0x7C, 0xC6, 0xCE, 0xDE, 0xF6, 0xE6, 0x7C, 0x00, 0x30, 0x70, 0x30, 0x30, 0x30, 0x30, 0xFC, 0x00, 
0x78, 0xCC, 0x0C, 0x38, 0x60, 0xCC, 0xFC, 0x00, 0x78, 0xCC, 0x0C, 0x38, 0x0C, 0xCC, 0x78, 0x00, 
0x1C, 0x3C, 0x6C, 0xCC, 0xFE, 0x0C, 0x1E, 0x00, 0xFC, 0xC0, 0xF8, 0x0C, 0x0C, 0xCC, 0x78, 0x00,
0x38, 0x60, 0xC0, 0xF8, 0xCC, 0xCC, 0x78, 0x00, 0xFC, 0xCC, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00, 
0x78, 0xCC, 0xCC, 0x78, 0xCC, 0xCC, 0x78, 0x00, 0x78, 0xCC, 0xCC, 0x7C, 0x0C, 0x18, 0x70, 0x00, 
0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x60,
0x18, 0x30, 0x60, 0xC0, 0x60, 0x30, 0x18, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0xFC, 0x00, 0x00, 
0x60, 0x30, 0x18, 0x0C, 0x18, 0x30, 0x60, 0x00, 0x78, 0xCC, 0x0C, 0x18, 0x30, 0x00, 0x30, 0x00, 
0x7C, 0xC6, 0xDE, 0xDE, 0xDE, 0xC0, 0x78, 0x00, 0x30, 0x78, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0x00,
0xFC, 0x66, 0x66, 0x7C, 0x66, 0x66, 0xFC, 0x00, 0x3C, 0x66, 0xC0, 0xC0, 0xC0, 0x66, 0x3C, 0x00, 
0xF8, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0xF8, 0x00, 0xFE, 0x62, 0x68, 0x78, 0x68, 0x62, 0xFE, 0x00, 
0xFE, 0x62, 0x68, 0x78, 0x68, 0x60, 0xF0, 0x00, 0x3C, 0x66, 0xC0, 0xC0, 0xCE, 0x66, 0x3E, 0x00,
0xCC, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0xCC, 0x00, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00, 
0x1E, 0x0C, 0x0C, 0x0C, 0xCC, 0xCC, 0x78, 0x00, 0xE6, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0xE6, 0x00, 
0xF0, 0x60, 0x60, 0x60, 0x62, 0x66, 0xFE, 0x00, 0xC6, 0xEE, 0xFE, 0xFE, 0xD6, 0xC6, 0xC6, 0x00,
0xC6, 0xE6, 0xF6, 0xDE, 0xCE, 0xC6, 0xC6, 0x00, 0x38, 0x6C, 0xC6, 0xC6, 0xC6, 0x6C, 0x38, 0x00, 
0xFC, 0x66, 0x66, 0x7C, 0x60, 0x60, 0xF0, 0x00, 0x78, 0xCC, 0xCC, 0xCC, 0xDC, 0x78, 0x1C, 0x00, 
0xFC, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0xE6, 0x00, 0x78, 0xCC, 0x60, 0x30, 0x18, 0xCC, 0x78, 0x00,
0xFC, 0xB4, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xFC, 0x00, 
0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x00, 0xC6, 0xC6, 0xC6, 0xD6, 0xFE, 0xEE, 0xC6, 0x00, 
0xC6, 0xC6, 0x6C, 0x38, 0x38, 0x6C, 0xC6, 0x00, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x30, 0x78, 0x00,
0xFE, 0xC6, 0x8C, 0x18, 0x32, 0x66, 0xFE, 0x00, 0x78, 0x60, 0x60, 0x60, 0x60, 0x60, 0x78, 0x00, 
0xC0, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x02, 0x00, 0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0x78, 0x00, 
0x10, 0x38, 0x6C, 0xC6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
0x30, 0x30, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x76, 0x00, 
0xE0, 0x60, 0x60, 0x7C, 0x66, 0x66, 0xDC, 0x00, 0x00, 0x00, 0x78, 0xCC, 0xC0, 0xCC, 0x78, 0x00, 
0x1C, 0x0C, 0x0C, 0x7C, 0xCC, 0xCC, 0x76, 0x00, 0x00, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00,
0x38, 0x6C, 0x60, 0xF0, 0x60, 0x60, 0xF0, 0x00, 0x00, 0x00, 0x76, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8, 
0xE0, 0x60, 0x6C, 0x76, 0x66, 0x66, 0xE6, 0x00, 0x30, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00, 
0x0C, 0x00, 0x0C, 0x0C, 0x0C, 0xCC, 0xCC, 0x78, 0xE0, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0xE6, 0x00,
0x70, 0x30, 0x30, 0x30, 0x30, 0x30, 0x78, 0x00, 0x00, 0x00, 0xCC, 0xFE, 0xFE, 0xD6, 0xC6, 0x00, 
0x00, 0x00, 0xF8, 0xCC, 0xCC, 0xCC, 0xCC, 0x00, 0x00, 0x00, 0x78, 0xCC, 0xCC, 0xCC, 0x78, 0x00, 
0x00, 0x00, 0xDC, 0x66, 0x66, 0x7C, 0x60, 0xF0, 0x00, 0x00, 0x76, 0xCC, 0xCC, 0x7C, 0x0C, 0x1E,
0x00, 0x00, 0xDC, 0x76, 0x66, 0x60, 0xF0, 0x00, 0x00, 0x00, 0x7C, 0xC0, 0x78, 0x0C, 0xF8, 0x00, 
0x10, 0x30, 0x7C, 0x30, 0x30, 0x34, 0x18, 0x00, 0x00, 0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0x76, 0x00, 
0x00, 0x00, 0xCC, 0xCC, 0xCC, 0x78, 0x30, 0x00, 0x00, 0x00, 0xC6, 0xD6, 0xFE, 0xFE, 0x6C, 0x00,
0x00, 0x00, 0xC6, 0x6C, 0x38, 0x6C, 0xC6, 0x00, 0x00, 0x00, 0xCC, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8, 
0x00, 0x00, 0xFC, 0x98, 0x30, 0x64, 0xFC, 0x00, 0x1C, 0x30, 0x30, 0xE0, 0x30, 0x30, 0x1C, 0x00, 
0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x00, 0xE0, 0x30, 0x30, 0x1C, 0x30, 0x30, 0xE0, 0x00,
0x76, 0xDC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x38, 0x6C, 0xC6, 0xC6, 0xFE, 0x00, 
0x78, 0xCC, 0xC0, 0xCC, 0x78, 0x18, 0x0C, 0x78, 0x00, 0xCC, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 
0x1C, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00, 0x7E, 0xC3, 0x3C, 0x06, 0x3E, 0x66, 0x3F, 0x00,
0xCC, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 0xE0, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 
0x30, 0x30, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 0x00, 0x00, 0x78, 0xC0, 0xC0, 0x78, 0x0C, 0x38, 
0x7E, 0xC3, 0x3C, 0x66, 0x7E, 0x60, 0x3C, 0x00, 0xCC, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00,
0xE0, 0x00, 0x78, 0xCC, 0xFC, 0xC0, 0x78, 0x00, 0xCC, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00, 
0x7C, 0xC6, 0x38, 0x18, 0x18, 0x18, 0x3C, 0x00, 0xE0, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00, 
0xC6, 0x38, 0x6C, 0xC6, 0xFE, 0xC6, 0xC6, 0x00, 0x30, 0x30, 0x00, 0x78, 0xCC, 0xFC, 0xCC, 0x00,
0x1C, 0x00, 0xFC, 0x60, 0x78, 0x60, 0xFC, 0x00, 0x00, 0x00, 0x7F, 0x0C, 0x7F, 0xCC, 0x7F, 0x00, 
0x3E, 0x6C, 0xCC, 0xFE, 0xCC, 0xCC, 0xCE, 0x00, 0x78, 0xCC, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00,
0x00, 0xCC, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00, 0x00, 0xE0, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00, 
0x78, 0xCC, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 0x00, 0xE0, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 
0x00, 0xCC, 0x00, 0xCC, 0xCC, 0x7C, 0x0C, 0xF8, 0xC3, 0x18, 0x3C, 0x66, 0x66, 0x3C, 0x18, 0x00, 
0xCC, 0x00, 0xCC, 0xCC, 0xCC, 0xCC, 0x78, 0x00, 0x18, 0x18, 0x7E, 0xC0, 0xC0, 0x7E, 0x18, 0x18,
0x38, 0x6C, 0x64, 0xF0, 0x60, 0xE6, 0xFC, 0x00, 0xCC, 0xCC, 0x78, 0xFC, 0x30, 0xFC, 0x30, 0x30, 
0xF8, 0xCC, 0xCC, 0xFA, 0xC6, 0xCF, 0xC6, 0xC7, 0x0E, 0x1B, 0x18, 0x3C, 0x18, 0x18, 0xD8, 0x70, 
0x1C, 0x00, 0x78, 0x0C, 0x7C, 0xCC, 0x7E, 0x00, 0x38, 0x00, 0x70, 0x30, 0x30, 0x30, 0x78, 0x00,
0x00, 0x1C, 0x00, 0x78, 0xCC, 0xCC, 0x78, 0x00, 0x00, 0x1C, 0x00, 0xCC, 0xCC, 0xCC, 0x7E, 0x00, 
0x00, 0xF8, 0x00, 0xF8, 0xCC, 0xCC, 0xCC, 0x00, 0xFC, 0x00, 0xCC, 0xEC, 0xFC, 0xDC, 0xCC, 0x00, 
0x3C, 0x6C, 0x6C, 0x3E, 0x00, 0x7E, 0x00, 0x00, 0x38, 0x6C, 0x6C, 0x38, 0x00, 0x7C, 0x00, 0x00,
0x30, 0x00, 0x30, 0x60, 0xC0, 0xCC, 0x78, 0x00, 0x00, 0x00, 0x00, 0xFC, 0xC0, 0xC0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xFC, 0x0C, 0x0C, 0x00, 0x00, 0xC3, 0xC6, 0xCC, 0xDE, 0x33, 0x66, 0xCC, 0x0F, 
0xC3, 0xC6, 0xCC, 0xDB, 0x37, 0x6F, 0xCF, 0x03, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00,
0x00, 0x33, 0x66, 0xCC, 0x66, 0x33, 0x00, 0x00, 0x00, 0xCC, 0x66, 0x33, 0x66, 0xCC, 0x00, 0x00, 
0x22, 0x88, 0x22, 0x88, 0x22, 0x88, 0x22, 0x88, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 
0xDB, 0x77, 0xDB, 0xEE, 0xDB, 0x77, 0xDB, 0xEE, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
0x18, 0x18, 0x18, 0x18, 0xF8, 0x18, 0x18, 0x18, 0x18, 0x18, 0xF8, 0x18, 0xF8, 0x18, 0x18, 0x18, 
0x36, 0x36, 0x36, 0x36, 0xF6, 0x36, 0x36, 0x36, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x36, 0x36, 0x36, 
0x00, 0x00, 0xF8, 0x18, 0xF8, 0x18, 0x18, 0x18, 0x36, 0x36, 0xF6, 0x06, 0xF6, 0x36, 0x36, 0x36,
0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x00, 0x00, 0xFE, 0x06, 0xF6, 0x36, 0x36, 0x36, 
0x36, 0x36, 0xF6, 0x06, 0xFE, 0x00, 0x00, 0x00, 0x36, 0x36, 0x36, 0x36, 0xFE, 0x00, 0x00, 0x00, 
0x18, 0x18, 0xF8, 0x18, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x18, 0x18, 0x18,
0x18, 0x18, 0x18, 0x18, 0x1F, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0xFF, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xFF, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1F, 0x18, 0x18, 0x18, 
0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0xFF, 0x18, 0x18, 0x18,
0x18, 0x18, 0x1F, 0x18, 0x1F, 0x18, 0x18, 0x18, 0x36, 0x36, 0x36, 0x36, 0x37, 0x36, 0x36, 0x36, 
0x36, 0x36, 0x37, 0x30, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x30, 0x37, 0x36, 0x36, 0x36, 
0x36, 0x36, 0xF7, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xF7, 0x36, 0x36, 0x36,
0x36, 0x36, 0x37, 0x30, 0x37, 0x36, 0x36, 0x36, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 
0x36, 0x36, 0xF7, 0x00, 0xF7, 0x36, 0x36, 0x36, 0x18, 0x18, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 
0x36, 0x36, 0x36, 0x36, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x18, 0x18, 0x18,
0x00, 0x00, 0x00, 0x00, 0xFF, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x3F, 0x00, 0x00, 0x00, 
0x18, 0x18, 0x1F, 0x18, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x18, 0x1F, 0x18, 0x18, 0x18, 
0x00, 0x00, 0x00, 0x00, 0x3F, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xFF, 0x36, 0x36, 0x36,
0x18, 0x18, 0xFF, 0x18, 0xFF, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xF8, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x1F, 0x18, 0x18, 0x18, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 
0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x76, 0xDC, 0xC8, 0xDC, 0x76, 0x00, 0x00, 0x78, 0xCC, 0xF8, 0xCC, 0xF8, 0xC0, 0xC0, 
0x00, 0xFC, 0xCC, 0xC0, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0xFE, 0x6C, 0x6C, 0x6C, 0x6C, 0x6C, 0x00,
0xFC, 0xCC, 0x60, 0x30, 0x60, 0xCC, 0xFC, 0x00, 0x00, 0x00, 0x7E, 0xD8, 0xD8, 0xD8, 0x70, 0x00, 
0x00, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x60, 0xC0, 0x00, 0x76, 0xDC, 0x18, 0x18, 0x18, 0x18, 0x00, 
0xFC, 0x30, 0x78, 0xCC, 0xCC, 0x78, 0x30, 0xFC, 0x38, 0x6C, 0xC6, 0xFE, 0xC6, 0x6C, 0x38, 0x00,
0x38, 0x6C, 0xC6, 0xC6, 0x6C, 0x6C, 0xEE, 0x00, 0x1C, 0x30, 0x18, 0x7C, 0xCC, 0xCC, 0x78, 0x00, 
0x00, 0x00, 0x7E, 0xDB, 0xDB, 0x7E, 0x00, 0x00, 0x06, 0x0C, 0x7E, 0xDB, 0xDB, 0x7E, 0x60, 0xC0, 
0x38, 0x60, 0xC0, 0xF8, 0xC0, 0x60, 0x38, 0x00, 0x78, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0x00,
0x00, 0xFC, 0x00, 0xFC, 0x00, 0xFC, 0x00, 0x00, 0x30, 0x30, 0xFC, 0x30, 0x30, 0x00, 0xFC, 0x00, 
0x60, 0x30, 0x18, 0x30, 0x60, 0x00, 0xFC, 0x00, 0x18, 0x30, 0x60, 0x30, 0x18, 0x00, 0xFC, 0x00, 
0x0E, 0x1B, 0x1B, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xD8, 0xD8, 0x70,
0x30, 0x30, 0x00, 0xFC, 0x00, 0x30, 0x30, 0x00, 0x00, 0x76, 0xDC, 0x00, 0x76, 0xDC, 0x00, 0x00, 
0x38, 0x6C, 0x6C, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x0C, 0x0C, 0x0C, 0xEC, 0x6C, 0x3C, 0x1C,
0x78, 0x6C, 0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x70, 0x18, 0x30, 0x60, 0x78, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x3C, 0x3C, 0x3C, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};*/

/* alternate font */
byte FONT[2048] = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x81, 0xA5, 0x81,
	0xBD, 0x99, 0x81, 0x7E, 0x7E, 0xFF, 0xDB, 0xFF, 0xC3, 0xE7, 0xFF, 0x7E,
	0x6C, 0xFE, 0xFE, 0xFE, 0x7C, 0x38, 0x10, 0x00, 0x10, 0x38, 0x7C, 0xFE,
	0x7C, 0x38, 0x10, 0x00, 0x38, 0x7C, 0x38, 0xFE, 0xD6, 0x10, 0x10, 0x7C,
	0x10, 0x10, 0x38, 0x7C, 0xFE, 0x7C, 0x10, 0x7C, 0x00, 0x00, 0x18, 0x3C,
	0x3C, 0x18, 0x00, 0x00, 0xFF, 0xFF, 0xE7, 0xC3, 0xC3, 0xE7, 0xFF, 0xFF,
	0x00, 0x3C, 0x66, 0x42, 0x42, 0x66, 0x3C, 0x00, 0xFF, 0xC3, 0x99, 0xBD,
	0xBD, 0x99, 0xC3, 0xFF, 0x1F, 0x03, 0x05, 0x7D, 0x84, 0x84, 0x84, 0x78,
	0x3E, 0x41, 0x41, 0x41, 0x3E, 0x08, 0x3E, 0x08, 0x3F, 0x21, 0x3F, 0x20,
	0x20, 0x20, 0x60, 0xC0, 0x3F, 0x21, 0x3F, 0x21, 0x21, 0x23, 0x66, 0xC0,
	0x99, 0x5A, 0x3C, 0xE7, 0xE7, 0x3C, 0x5A, 0x99, 0x80, 0xE0, 0xF8, 0xFE,
	0xF8, 0xE0, 0x80, 0x00, 0x02, 0x0E, 0x3E, 0xFE, 0x3E, 0x0E, 0x02, 0x00,
	0x10, 0x38, 0x7C, 0x10, 0x10, 0x7C, 0x38, 0x10, 0x24, 0x24, 0x24, 0x24,
	0x24, 0x00, 0x24, 0x00, 0x7F, 0x92, 0x92, 0x72, 0x12, 0x12, 0x12, 0x00,
	0x3E, 0x61, 0x38, 0x44, 0x44, 0x38, 0x8C, 0x78, 0x00, 0x00, 0x00, 0x00,
	0x7E, 0x7E, 0x7E, 0x00, 0x10, 0x38, 0x7C, 0x10, 0x7C, 0x38, 0x10, 0xFE,
	0x10, 0x38, 0x7C, 0x10, 0x10, 0x10, 0x10, 0x00, 0x10, 0x10, 0x10, 0x10,
	0x7C, 0x38, 0x10, 0x00, 0x00, 0x08, 0x04, 0xFE, 0x04, 0x08, 0x00, 0x00,
	0x00, 0x20, 0x40, 0xFE, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80,
	0x80, 0xFE, 0x00, 0x00, 0x00, 0x24, 0x66, 0xFF, 0x66, 0x24, 0x00, 0x00,
	0x00, 0x18, 0x3C, 0x7E, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x7E,
	0x3C, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x10, 0x38, 0x38, 0x10, 0x10, 0x00, 0x10, 0x00, 0x24, 0x24, 0x24, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x24, 0x24, 0xFF, 0x24, 0xFF, 0x24, 0x24, 0x00,
	0x10, 0x7C, 0x80, 0x78, 0x04, 0xF8, 0x10, 0x00, 0x00, 0xC6, 0xCC, 0x18,
	0x30, 0x66, 0xC6, 0x00, 0x38, 0x44, 0x38, 0x56, 0x84, 0x84, 0x76, 0x00,
	0x20, 0x20, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x20, 0x40, 0x40,
	0x40, 0x20, 0x10, 0x00, 0x20, 0x10, 0x08, 0x08, 0x08, 0x10, 0x20, 0x00,
	0x00, 0x44, 0x38, 0xFE, 0x38, 0x44, 0x00, 0x00, 0x00, 0x10, 0x10, 0xFE,
	0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x20,
	0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x10, 0x10, 0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x00,
	0x7C, 0x82, 0x86, 0x8A, 0x92, 0xA2, 0x7C, 0x00, 0x10, 0x30, 0x10, 0x10,
	0x10, 0x10, 0x7C, 0x00, 0x78, 0x84, 0x04, 0x10, 0x40, 0x84, 0xFC, 0x00,
	0x78, 0x84, 0x04, 0x38, 0x04, 0x84, 0x78, 0x00, 0x08, 0x18, 0x28, 0x48,
	0xFE, 0x08, 0x1C, 0x00, 0xFC, 0x80, 0xF8, 0x04, 0x04, 0x84, 0x78, 0x00,
	0x38, 0x40, 0x80, 0xF8, 0x84, 0x84, 0x78, 0x00, 0xFC, 0x84, 0x08, 0x10,
	0x20, 0x20, 0x20, 0x00, 0x78, 0x84, 0x84, 0x78, 0x84, 0x84, 0x78, 0x00,
	0x78, 0x84, 0x84, 0x7C, 0x04, 0x08, 0x70, 0x00, 0x00, 0x10, 0x10, 0x00,
	0x00, 0x10, 0x10, 0x00, 0x00, 0x10, 0x10, 0x00, 0x00, 0x10, 0x10, 0x20,
	0x10, 0x20, 0x40, 0x80, 0x40, 0x20, 0x10, 0x00, 0x00, 0x00, 0xFC, 0x00,
	0x00, 0xFC, 0x00, 0x00, 0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x20, 0x00,
	0x78, 0x84, 0x04, 0x08, 0x10, 0x00, 0x10, 0x00, 0x7C, 0x82, 0x9E, 0x92,
	0x9E, 0x80, 0x78, 0x00, 0x30, 0x48, 0x84, 0x84, 0xFC, 0x84, 0x84, 0x00,
	0xFC, 0x42, 0x42, 0x7C, 0x42, 0x42, 0xFC, 0x00, 0x3C, 0x42, 0x80, 0x80,
	0x80, 0x42, 0x3C, 0x00, 0xF8, 0x44, 0x42, 0x42, 0x42, 0x44, 0xF8, 0x00,
	0xFE, 0x42, 0x48, 0x78, 0x48, 0x42, 0xFE, 0x00, 0xFE, 0x42, 0x48, 0x78,
	0x48, 0x40, 0xE0, 0x00, 0x3C, 0x42, 0x80, 0x80, 0x8E, 0x42, 0x3E, 0x00,
	0x84, 0x84, 0x84, 0xFC, 0x84, 0x84, 0x84, 0x00, 0x38, 0x10, 0x10, 0x10,
	0x10, 0x10, 0x38, 0x00, 0x0E, 0x04, 0x04, 0x04, 0x44, 0x44, 0x38, 0x00,
	0xC2, 0x44, 0x48, 0x70, 0x44, 0x42, 0xC2, 0x00, 0xE0, 0x40, 0x40, 0x40,
	0x40, 0x42, 0xFE, 0x00, 0x82, 0xC6, 0xAA, 0x92, 0x82, 0x82, 0x82, 0x00,
	0x82, 0xC2, 0xA2, 0x92, 0x8A, 0x86, 0x82, 0x00, 0x38, 0x44, 0x82, 0x82,
	0x82, 0x44, 0x38, 0x00, 0xFC, 0x42, 0x42, 0x7C, 0x40, 0x40, 0xE0, 0x00,
	0x38, 0x44, 0x82, 0x82, 0x82, 0x54, 0x38, 0x04, 0xFC, 0x42, 0x42, 0x7C,
	0x44, 0x42, 0xC2, 0x00, 0x78, 0x84, 0x80, 0x78, 0x04, 0x84, 0x78, 0x00,
	0xFE, 0x92, 0x10, 0x10, 0x10, 0x10, 0x38, 0x00, 0x84, 0x84, 0x84, 0x84,
	0x84, 0x84, 0xFC, 0x00, 0x84, 0x84, 0x84, 0x84, 0x84, 0x48, 0x30, 0x00,
	0x82, 0x82, 0x82, 0x92, 0xAA, 0xC6, 0x82, 0x00, 0x82, 0x44, 0x28, 0x10,
	0x28, 0x44, 0x82, 0x00, 0x82, 0x44, 0x28, 0x10, 0x10, 0x10, 0x38, 0x00,
	0xFE, 0x84, 0x88, 0x10, 0x22, 0x42, 0xFE, 0x00, 0x78, 0x40, 0x40, 0x40,
	0x40, 0x40, 0x78, 0x00, 0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x00,
	0x78, 0x08, 0x08, 0x08, 0x08, 0x08, 0x78, 0x00, 0x10, 0x28, 0x44, 0x82,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
	0x20, 0x20, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x04,
	0x7C, 0x84, 0x76, 0x00, 0xC0, 0x40, 0x7C, 0x42, 0x42, 0x42, 0xDC, 0x00,
	0x00, 0x00, 0x78, 0x84, 0x80, 0x84, 0x78, 0x00, 0x0C, 0x04, 0x7C, 0x84,
	0x84, 0x84, 0x76, 0x00, 0x00, 0x00, 0x78, 0x84, 0xFC, 0x80, 0x78, 0x00,
	0x38, 0x44, 0x40, 0xE0, 0x40, 0x40, 0xE0, 0x00, 0x00, 0x00, 0x76, 0x84,
	0x84, 0x7C, 0x04, 0xF8, 0xC0, 0x40, 0x4C, 0x62, 0x42, 0x42, 0xC2, 0x00,
	0x10, 0x00, 0x30, 0x10, 0x10, 0x10, 0x38, 0x00, 0x04, 0x00, 0x04, 0x04,
	0x04, 0x84, 0x84, 0x78, 0xC0, 0x40, 0x42, 0x44, 0x78, 0x44, 0xC2, 0x00,
	0x30, 0x10, 0x10, 0x10, 0x10, 0x10, 0x38, 0x00, 0x00, 0x00, 0xEC, 0x92,
	0x92, 0x92, 0x82, 0x00, 0x00, 0x00, 0xF8, 0x84, 0x84, 0x84, 0x84, 0x00,
	0x00, 0x00, 0x78, 0x84, 0x84, 0x84, 0x78, 0x00, 0x00, 0x00, 0xDC, 0x42,
	0x42, 0x7C, 0x40, 0xE0, 0x00, 0x00, 0x76, 0x84, 0x84, 0x7C, 0x04, 0x0E,
	0x00, 0x00, 0xDC, 0x62, 0x40, 0x40, 0xE0, 0x00, 0x00, 0x00, 0x7C, 0x80,
	0x78, 0x04, 0xF8, 0x00, 0x10, 0x10, 0x7C, 0x10, 0x10, 0x12, 0x0C, 0x00,
	0x00, 0x00, 0x84, 0x84, 0x84, 0x84, 0x76, 0x00, 0x00, 0x00, 0x84, 0x84,
	0x84, 0x48, 0x30, 0x00, 0x00, 0x00, 0x82, 0x92, 0xAA, 0xC6, 0x82, 0x00,
	0x00, 0x00, 0x84, 0x48, 0x30, 0x48, 0x84, 0x00, 0x00, 0x00, 0x84, 0x84,
	0x84, 0x7C, 0x04, 0xF8, 0x00, 0x00, 0xFC, 0x88, 0x30, 0x44, 0xFC, 0x00,
	0x18, 0x20, 0x20, 0xC0, 0x20, 0x20, 0x18, 0x00, 0x10, 0x10, 0x10, 0x00,
	0x10, 0x10, 0x10, 0x00, 0x60, 0x10, 0x10, 0x0C, 0x10, 0x10, 0x60, 0x00,
	0x64, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x28, 0x44,
	0x82, 0x82, 0xFE, 0x00, 0x78, 0x84, 0x80, 0x84, 0x78, 0x18, 0x04, 0x78,
	0x00, 0x84, 0x00, 0x84, 0x84, 0x84, 0x7A, 0x00, 0x0C, 0x00, 0x78, 0x84,
	0xFC, 0x80, 0x78, 0x00, 0x7E, 0x81, 0x3C, 0x02, 0x3E, 0x42, 0x3D, 0x00,
	0x84, 0x00, 0x78, 0x04, 0x7C, 0x84, 0x7A, 0x00, 0xC0, 0x00, 0x78, 0x04,
	0x7C, 0x84, 0x7A, 0x00, 0x20, 0x20, 0x78, 0x04, 0x7C, 0x84, 0x7A, 0x00,
	0x00, 0x00, 0x78, 0x80, 0x80, 0x78, 0x04, 0x38, 0x7E, 0x81, 0x3C, 0x42,
	0x7E, 0x40, 0x3C, 0x00, 0x84, 0x00, 0x78, 0x84, 0xFC, 0x80, 0x78, 0x00,
	0x60, 0x00, 0x78, 0x84, 0xFC, 0x80, 0x78, 0x00, 0x48, 0x00, 0x30, 0x10,
	0x10, 0x10, 0x38, 0x00, 0x7C, 0x82, 0x30, 0x10, 0x10, 0x10, 0x38, 0x00,
	0x60, 0x00, 0x30, 0x10, 0x10, 0x10, 0x38, 0x00, 0x82, 0x38, 0x44, 0x82,
	0xFE, 0x82, 0x82, 0x00, 0x30, 0x10, 0x44, 0x82, 0xFE, 0x82, 0x82, 0x00,
	0x0C, 0xFC, 0x40, 0x78, 0x40, 0x40, 0xFC, 0x00, 0x00, 0x00, 0x67, 0x19,
	0x7F, 0x98, 0x77, 0x00, 0x3F, 0x48, 0x88, 0xFF, 0x88, 0x88, 0x8F, 0x00,
	0x78, 0x84, 0x78, 0x84, 0x84, 0x84, 0x78, 0x00, 0x84, 0x00, 0x78, 0x84,
	0x84, 0x84, 0x78, 0x00, 0xC0, 0x00, 0x78, 0x84, 0x84, 0x84, 0x78, 0x00,
	0x7E, 0x81, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00, 0x20, 0x10, 0x42, 0x42,
	0x42, 0x42, 0x3C, 0x00, 0x84, 0x00, 0x84, 0x84, 0x84, 0x7C, 0x04, 0xF8,
	0x42, 0x18, 0x24, 0x42, 0x42, 0x24, 0x18, 0x00, 0x84, 0x00, 0x84, 0x84,
	0x84, 0x84, 0x78, 0x00, 0x10, 0x10, 0x7E, 0x80, 0x80, 0x7E, 0x10, 0x10,
	0x38, 0x44, 0x44, 0xE0, 0x40, 0x82, 0xFC, 0x00, 0x44, 0x28, 0x10, 0x7C,
	0x10, 0x7C, 0x10, 0x10, 0xF8, 0x84, 0x84, 0xF8, 0x82, 0x87, 0x82, 0x83,
	0x0C, 0x12, 0x10, 0x38, 0x10, 0x10, 0x90, 0x60, 0x1C, 0x00, 0x78, 0x04,
	0x7C, 0x84, 0x7A, 0x00, 0x18, 0x00, 0x30, 0x10, 0x10, 0x10, 0x38, 0x00,
	0x08, 0x10, 0x78, 0x84, 0x84, 0x84, 0x78, 0x00, 0x08, 0x10, 0x84, 0x84,
	0x84, 0x84, 0x7A, 0x00, 0x64, 0x98, 0xB8, 0xC4, 0x84, 0x84, 0x84, 0x00,
	0x64, 0x98, 0x84, 0xA4, 0x94, 0x84, 0x84, 0x00, 0x3C, 0x44, 0x44, 0x3A,
	0x00, 0x7E, 0x00, 0x00, 0x38, 0x44, 0x44, 0x38, 0x00, 0x7C, 0x00, 0x00,
	0x20, 0x00, 0x20, 0x40, 0x80, 0x84, 0x78, 0x00, 0x00, 0x00, 0x00, 0xFC,
	0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x0C, 0x0C, 0x00, 0x00,
	0x42, 0x44, 0x48, 0x56, 0x69, 0x42, 0x84, 0x0F, 0x42, 0x44, 0x48, 0x53,
	0x65, 0x49, 0x8F, 0x01, 0x10, 0x10, 0x00, 0x10, 0x38, 0x38, 0x10, 0x00,
	0x00, 0x22, 0x44, 0x88, 0x44, 0x22, 0x00, 0x00, 0x00, 0x44, 0x22, 0x11,
	0x22, 0x44, 0x00, 0x00, 0x22, 0x88, 0x22, 0x88, 0x22, 0x88, 0x22, 0x88,
	0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0xDB, 0x77, 0xDB, 0xEE,
	0xDB, 0x77, 0xDB, 0xEE, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
	0x18, 0x18, 0x18, 0x18, 0xF8, 0x18, 0x18, 0x18, 0x18, 0x18, 0xF8, 0x18,
	0xF8, 0x18, 0x18, 0x18, 0x36, 0x36, 0x36, 0x36, 0xF6, 0x36, 0x36, 0x36,
	0x00, 0x00, 0x00, 0x00, 0xFE, 0x36, 0x36, 0x36, 0x00, 0x00, 0xF8, 0x18,
	0xF8, 0x18, 0x18, 0x18, 0x36, 0x36, 0xF6, 0x06, 0xF6, 0x36, 0x36, 0x36,
	0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x00, 0x00, 0xFE, 0x06,
	0xF6, 0x36, 0x36, 0x36, 0x36, 0x36, 0xF6, 0x06, 0xFE, 0x00, 0x00, 0x00,
	0x36, 0x36, 0x36, 0x36, 0xFE, 0x00, 0x00, 0x00, 0x18, 0x18, 0xF8, 0x18,
	0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x18, 0x18, 0x18,
	0x18, 0x18, 0x18, 0x18, 0x1F, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18,
	0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x18, 0x18, 0x18,
	0x18, 0x18, 0x18, 0x18, 0x1F, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0xFF, 0x18, 0x18, 0x18,
	0x18, 0x18, 0x1F, 0x18, 0x1F, 0x18, 0x18, 0x18, 0x36, 0x36, 0x36, 0x36,
	0x37, 0x36, 0x36, 0x36, 0x36, 0x36, 0x37, 0x30, 0x3F, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x3F, 0x30, 0x37, 0x36, 0x36, 0x36, 0x36, 0x36, 0xF7, 0x00,
	0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xF7, 0x36, 0x36, 0x36,
	0x36, 0x36, 0x37, 0x30, 0x37, 0x36, 0x36, 0x36, 0x00, 0x00, 0xFF, 0x00,
	0xFF, 0x00, 0x00, 0x00, 0x36, 0x36, 0xF7, 0x00, 0xF7, 0x36, 0x36, 0x36,
	0x18, 0x18, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x36, 0x36, 0x36, 0x36,
	0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x18, 0x18, 0x18,
	0x00, 0x00, 0x00, 0x00, 0xFF, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36,
	0x3F, 0x00, 0x00, 0x00, 0x18, 0x18, 0x1F, 0x18, 0x1F, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x1F, 0x18, 0x1F, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00,
	0x3F, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xFF, 0x36, 0x36, 0x36,
	0x18, 0x18, 0xFF, 0x18, 0xFF, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
	0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x18, 0x18, 0x18,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
	0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x62, 0x94, 0x88, 0x94, 0x62, 0x00,
	0x00, 0x78, 0x84, 0xF8, 0x84, 0xF8, 0x80, 0x80, 0x00, 0xFC, 0x84, 0x80,
	0x80, 0x80, 0x80, 0x00, 0x00, 0xFE, 0x28, 0x28, 0x28, 0x28, 0x28, 0x00,
	0xFC, 0x84, 0x40, 0x20, 0x40, 0x84, 0xFC, 0x00, 0x00, 0x00, 0x7E, 0x88,
	0x88, 0x88, 0x70, 0x00, 0x00, 0x42, 0x42, 0x42, 0x42, 0x7C, 0x40, 0x80,
	0x00, 0x76, 0x88, 0x08, 0x08, 0x08, 0x08, 0x00, 0xF8, 0x20, 0x70, 0x88,
	0x88, 0x70, 0x20, 0xF8, 0x38, 0x44, 0x82, 0xFE, 0x82, 0x44, 0x38, 0x00,
	0x38, 0x44, 0x82, 0x82, 0x28, 0x28, 0x6C, 0x00, 0x1C, 0x10, 0x08, 0x7C,
	0x84, 0x84, 0x78, 0x00, 0x00, 0x00, 0x7C, 0x92, 0x92, 0x7C, 0x00, 0x00,
	0x02, 0x04, 0x7E, 0x89, 0x91, 0x7E, 0x40, 0x80, 0x38, 0x40, 0x80, 0xF8,
	0x80, 0x40, 0x38, 0x00, 0x78, 0x84, 0x84, 0x84, 0x84, 0x84, 0x84, 0x00,
	0x00, 0xFC, 0x00, 0xFC, 0x00, 0xFC, 0x00, 0x00, 0x20, 0x20, 0xFC, 0x20,
	0x20, 0x00, 0xFC, 0x00, 0x40, 0x20, 0x10, 0x20, 0x40, 0x00, 0xFC, 0x00,
	0x10, 0x20, 0x40, 0x20, 0x10, 0x00, 0xFC, 0x00, 0x0E, 0x11, 0x11, 0x10,
	0x10, 0x10, 0x10, 0x10, 0x08, 0x08, 0x08, 0x08, 0x08, 0x88, 0x88, 0x70,
	0x20, 0x20, 0x00, 0xF8, 0x00, 0x20, 0x20, 0x00, 0x00, 0x64, 0x98, 0x00,
	0x64, 0x98, 0x00, 0x00, 0x38, 0x44, 0x44, 0x38, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x18, 0x00, 0x00, 0x00, 0x07, 0x04, 0x04, 0x04, 0x64, 0x24, 0x1C, 0x0C,
	0x58, 0x44, 0x44, 0x44, 0x44, 0x00, 0x00, 0x00, 0x30, 0x48, 0x10, 0x20,
	0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x3C, 0x3C, 0x3C, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

/****************/
/* PRIVATE CORE */
/****************/
void _SwapBuffers()
{
    while (inportb(0x3DA) & 0x08);
    while (!(inportb(0x3DA) & 0x08));

    movedata(FP_SEG(CORE.buffer_0), FP_OFF(CORE.buffer_0), FP_SEG(CGA_0), FP_OFF(CGA_0), 8000);
    movedata(FP_SEG(CORE.buffer_1), FP_OFF(CORE.buffer_1), FP_SEG(CGA_1), FP_OFF(CGA_1), 8000);
}

/**********/
void _SoundUpdate()
{
    if(TimerGet(&CORE.sound_timer) > CORE.sound_len)
    {
        TimerStop(&CORE.sound_timer);
        StopSound();
    }
}
/***************/
/* PUBLIC CORE */
/***************/
void Init()
{
    union REGS regs = {0};

    CORE.buffer_0 = calloc(8000,sizeof(byte));
    CORE.buffer_1 = calloc(8000,sizeof(byte));

    regs.h.ah = 0x0F;
    int86(0x10, &regs, &regs );
    CORE.restore_mode = regs.h.al;

    regs.h.ah = 0x00;
    regs.h.al = 0x04;
    int86(0x10, &regs, &regs );

    CORE.sound_timer = TimerInit();

    srand(time(NULL));
}

/**********/
void Close()
{
    union REGS regs = {0};

    regs.h.ah = 0x00;
    regs.h.al = CORE.restore_mode;
    int86(0x10, &regs, &regs);

    free(CORE.buffer_0);
    free(CORE.buffer_1);

    StopSound();
}

/**********/
void Update()
{
    _SwapBuffers();
    _SoundUpdate();
}

/**********/
void Palette(byte p)
{
    union REGS regs = {0};

    regs.h.ah = 0x0B;
    regs.h.bh = 0x01;
    regs.h.bl = p;

    int86(0x10, &regs, &regs);
}

/**********/
void Clear(byte c)
{
    byte b = (c<<6) + (c<<4) + (c<<2) + c;
    
	memset(CORE.buffer_0, b, 8000);
	memset(CORE.buffer_1, b, 8000);
}

/**********/
void Color(byte c)
{
	CORE.color = c << 6;
}

/**********/
void Pixel(int x, int y)
{
	byte c = 0;
	byte p_index = 0;
	byte b_index = 0;
	byte *p = NULL;

	if(x<0 || x>=WIDTH || y<0 || y>=HEIGHT){ return; }

	p_index = x%4;
	b_index = x >> 2;

    c = CORE.color >> (p_index << 1);

	p = CORE.buffer_0;
	if(y & 0x01) { p = CORE.buffer_1; }

	p += 80*(y >> 1) + b_index ;

    *p = (*p & (~PIXEL_MASK[p_index])) + c;

}

/**********/
void Line(int sx, int sy, int dx, int dy)
{
    int _dx = abs(dx-sx);
    int _sx = sx<dx ? 1 : -1;
    int _dy = abs(dy-sy);
    int _sy = sy<dy ? 1 : -1; 
    int e = 0;
    int err = (_dx>_dy ? _dx : -_dy);
    err = err/2;

    while(1)
    {
        Pixel(sx, sy);
        if (sx==dx && sy==dy) break;
        e = err;
        if (e >-_dx) { err -= _dy; sx += _sx; }
        if (e < _dy) { err += _dx; sy += _sy; }
    }

}

/**********/
void Triangle(int ax, int ay, int bx, int by, int cx, int cy)
{
    Line(ax,ay,bx,by);
    Line(bx,by,cx,cy);
    Line(cx,cy,ax,ay);
}

/**********/
static void _TriangleFillBotFlat(int ax, int ay, int bx, int by, int cx, int cy)
{
    int i = 0;

    float left = (float)(bx-ax)/(float)(by-ay);
    float right = (float)(cx-ax)/(float)(cy-ay);

    float start = (float)ax;
    float end = (float)ax;

    for(i=ay;i<=by;i++)
    {
        /* note +0.55f just for round */
        Line((int)(start+0.55f),i,(int)(end+0.55f),i);

        start += left;
        end += right;
    }
}

/**********/
static void _TriangleFillTopFlat(int ax, int ay, int bx, int by, int cx, int cy)
{
    int i = 0;

    float left = (float)(cx-ax)/(float)(cy-ay);
    float right = (float)(cx-bx)/(float)(cy-by);

    float start = (float)cx;
    float end = (float)cx;

    for(i=cy;i>ay;i--)
    {
        /* note +0.55f just for round */
        Line((int)(start+0.55f),i,(int)(end+0.55f),i);

        start -= left;
        end -= right;
    }
}

/**********/
void TriangleFill(int ax, int ay, int bx, int by, int cx, int cy)
{
    int dx = 0;
    int dy = 0;

    /* sort vertices by y */
    if (ay > by){ Swap(&ay, &by); Swap(&ax, &bx); }
    if (ay > cy){ Swap(&ay, &cy); Swap(&ax, &cx); }
    if (by > cy){ Swap(&by, &cy); Swap(&bx, &cx); }

    if(by==cy)
    {
        _TriangleFillBotFlat(ax,ay,bx,by,cx,cy);
    }
    else if (ay==by)
    {
        _TriangleFillTopFlat(ax,ay,bx,by,cx,cy);
    }
    else
    {
        dx = (int)( (float)ax + ((float)(by - ay) / (float)(cy - ay)) * (float)(cx - ax));
        dy = by;

        _TriangleFillBotFlat(ax,ay,bx,by,dx,dy);
        _TriangleFillTopFlat(bx,by,dx,dy,cx,cy);
    }
}

/**********/
void Rectangle(int x, int y, int w, int h)
{
    Line(    x,     y,  x+w-1,       y);
    Line(x+w-1,     y,  x+w-1,   y+h-1);
    Line(x+w-1, y+h-1,      x,   y+h-1);
    Line(    x, y+h-1,      x,       y);
}

/**********/
void RectangleFill(int x, int y, int w, int h)
{
    int i = 0;
    
    for(i=0;i<h;i++)
    {
        Line(x,y+i,x+w-1,y+i);
    }
}

/**********/
void Circle(int cx, int cy, int r)
{
    int offx = 0; 
    int offy = r;
	int d = r-1;
	
    while (offy >= offx) 
    {
        Pixel(cx + offx, cy + offy);
        Pixel(cx + offy, cy + offx);
        Pixel(cx - offx, cy + offy);
        Pixel(cx - offy, cy + offx);
        Pixel(cx + offx, cy - offy);
        Pixel(cx + offy, cy - offx);
        Pixel(cx - offx, cy - offy);
        Pixel(cx - offy, cy - offx);
	
        if (d >= 2*offx) 
        {
            d -= 2*offx + 1;
            offx +=1;
        }
	    else if (d < 2 * (r - offy)) 
        {
            d += 2 * offy - 1;
            offy -= 1;
        }
        else 
        {
            d += 2 * (offy - offx - 1);
            offy -= 1;
            offx += 1;
        }
    }
}

/**********/
void CircleFill(int cx, int cy, int r)
{
    int offx = 0; 
    int offy = r;
	int d = r-1;
	
    while (offy >= offx) 
    {	
        Line(cx - offy, cy + offx, cx + offy, cy + offx);
        Line(cx - offx, cy + offy, cx + offx, cy + offy);
        Line(cx - offx, cy - offy, cx + offx, cy - offy);
        Line(cx - offy, cy - offx, cx + offy, cy - offx);
        
        if (d >= 2*offx) 
        {
            d -= 2*offx + 1;
            offx +=1;
        }
        else if (d < 2 * (r - offy)) 
        {
            d += 2 * offy - 1;
            offy -= 1;
        }
        else 
        {
            d += 2 * (offy - offx - 1);
            offy -= 1;
            offx += 1;
        }
    }
}

/**********/
void Image(byte *buf, int w, int h, int x, int y)
{
    int counter = 0;
    int i = 0;
    int j = 0;

    for(i=0;i<h;i++)
    {
        for(j=0;j<w;j++)
        {
            Color(buf[counter]);

            Pixel(j+x,i+y);

            counter++;
        }
    }
}

/**********/
void ImageMask(byte *buf, int w, int h, int x, int y, byte mask)
{
    int counter = 0;
    int i = 0;
    int j = 0;

    for(i=0;i<h;i++)
    {
        for(j=0;j<w;j++)
        {
            if(buf[counter]!=mask)
            {
                Color(buf[counter]);

                Pixel(j+x,i+y);
            }

            counter++;
        }
    }
}

/**********/
void Char(char c, int x, int y)
{
    int i = 0;
    int j = 0;

    byte val = 0;
    byte b = 0;
    byte *bytes = (byte *)FONT + ((byte)c * FONT_H);

	for(i=0;i<FONT_H;i++)
    {
		b = bytes[i];

		for(j=0;j<FONT_W;j++)
    	{
			val = (b>>(FONT_W-j) ) & 1;

			if(val == 0x00){ continue; }

            Pixel(j+x, i+y);
		}
    }
}

/**********/
void String(char *s, int x, int y)
{
    size_t len = strlen(s);
	int posx = x;
	int posy = y;
    int i = 0;

	for(i=0;i<len;i++)
	{	
		if(s[i]==CHARSET_LF){ posy += FONT_H; posx = x; continue; };

		if(s[i]!=CHARSET_SP) { Char(s[i], posx, posy); }

		posx += FONT_W;
	}
}

/**********/
void Sound(int note, float len)
{
    byte b = 0;

    if(CORE.sound_timer.started) { return; }

    CORE.sound_len = len;

    TimerStart(&CORE.sound_timer);

    if(note)
    { 
        outportb(0x43, 0xB6);                       /*prepare speaker*/ 

        outportb(0x42, (byte)(note & 0xFF)) ;       /* send note low byte */

        outportb(0x42, (byte)( (note>>8) & 0xFF));  /* send note high byte */

        b = inportb(0x61);                          /* get current status */
                                          
        outportb(0x61, (b | 0x03));                 /* set bit 0 and 1, send back data */                
    }
}

/**********/
void StopSound()
{
    byte b = inportb(0x61);        /* get current status */

    outportb(0x61, (b & 0xFC));     /* un-set bit 0 and 1, send back data */               

    TimerStop(&CORE.sound_timer);
}

/**********/
int SoundPlaying()
{
    return CORE.sound_timer.started;
}
